# Replacement of Pod Security Policies

## Overview

Pod Security Policies as a toolset to ensure compliance with dedicated Pod settings is no longer part of Kubernetes in version 1.25. As a replacement, Kubernetes introduced the so-called [Pod Security Standards](https://kubernetes.io/docs/concepts/security/pod-security-standards) and an admission controller ([Pod Security Admission](https://kubernetes.io/docs/concepts/security/pod-security-admission/)) to enforce the Pod Security Standards. The Pod Security Standard contains 3 different standards: unrestricted, baseline and restricted. While the first standard has no restrictions, the other 2 contain different security settings.

## Kyma Pod Security Policies

Most of the Pod Security Policies of Kyma are not as restrictive as the baseline or the restricted standard. Because of this, the Kyma related workloads can have specifications which are not compatible with the baseline or the restricted standard.

## Create secure Pod specifications

Pod Security Policies as well as Pod Security Standards are enforced via a so-called Admission controller. This means, that the rules are validated and further actions are taken immediately before the Pod is deployed. A mechanism like this works very well to ensure compliance with some rules but secure Pod specifications must be created earlier. In an optimal setup, the Pod specifications ensure the same or a better security level than the compliance rules. If this is the case, deployments never fail because of insecure or non-compliant Pods or Containers.

## Compliance with Pod Security Standards

To decide whether you can activate the Pod Security Standards on the kyma-system Namespace or not, and which level we can use, you must check the existing Pod specifications against the Pod Security Standards. If the Pod specification doesn't meet the requirements, you must try to change the existing Pod specification to implement the most secure setting. For more information, see [Create secure Pod specifications](#create-secure-pod-specifications). To decide if the specification files are compatible, and to change the specifications, you can use one of the two Pod specification templates containing the security relevant entries. They ensure compliance with the respective standard.

- [Pod Security Standard - baseline level](baseline-pod-spec.yaml)
- [Pod Security Standard - restricted level](restricted-pod-spec.yaml)

## Differences between baseline and restricted standards

| Control                  | Baseline                                                                                                                                                                                                                                                                | Restricted                                                                                                                                                                                                                                   |
| ------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Volume Types             | HostPath volumes are forbidden                                                                                                                                                                                                                                          | Only dedicated volume types allowed<br>- csi<br>- downwardAPI<br>- configMap<br>- emptyDir<br>- ephemeral<br>- persistentVolumeClaim<br>- projected<br>- secret                                                                              |
| Privilege Escalation     | No opinion                                                                                                                                                                                                                                                              | Privilege escalation is not allowed<br><br>`spec.<anycontainer>[*].securityContext.allowPrivilegeEscalation = false`                                                                                                                         |
| Running as Non-root      | No opinion                                                                                                                                                                                                                                                              | Containers must be required to run as non-root users<br><br>`spec.<anycontainer>[*].securityContext.runAsNonRoot = true`                                                                                                                     |
| Running as Non-root user | No Opinion<br><br>If this setting is needed, you should not set it to 0 because this is the ID of the root user.                                                                                                                                                     | Containers must set runAsUser to a value different from 0, values > 10000 are optimal to limit frictions with existing user accounts<br><br>`spec.securityContext.runAsUser != 0`<br>`spec.<anycontainer>[*].securityContext.runAsUser != 0` |
| Seccomp                  | Optional<br><br>Allowed values are:<br>- RuntimeDefault<br>- Localhost                                                                                                                                                                                                  | Mandatory<br><br>Allowed values are:<br>- RuntimeDefault<br>- Localhost                                                                                                                                                                      |
| Capabilities             | Only additional capabilities from the list below are allowed.<br><br>- Undefined/nil<br>- AUDIT_WRITE<br>- CHOWN<br>- DAC_OVERRIDE<br>- FOWNER<br>- FSETID<br>- KILL<br>- MKNOD<br>- NET_BIND_SERVICE<br>- SETFCAP<br>- SETGID<br>- SETPCAP<br>- SETUID<br>- SYS_CHROOT | Containers must drop ALL capabilities, and are only permitted to add back the NET_BIND_SERVICE capability.                                                                                                                                   |
