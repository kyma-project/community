1. Create module operator

 - create a repository for your module on github and clone it locally on your machine (github.com/acme/dummy-kyma-module.git in the following example) 
 - in the module folder, use [kubebuilder](https://book.kubebuilder.io/quick-start.html) to initialize scaffold of the project and create module API (here `dummy.operator.acme.io/v1alpha1` Custom Resource Definition and generate empty controller to put reconciliation logic for it)

```bash
 kubebuilder init --domain acme.io --repo github.com/acme/dummy-kyma-module.git
 kubebuilder create api --group operator --version v1alpha1 --kind Dummy
```
Change the target namespace in the `config/default/kustomization.yaml` to `kyma-system`

```bash
 make manifests
```

Remove namespace definition from `config/manager/manager.yaml` manifest (not to include kyma-system in your module resources)

 - define your API (CRD) and reconciliation logic. Make sure to fulfil the contract towards lifecycle manager (i.e your operator should set status "Ready" in your module's custom resource upon succesful reconciliation) Run and test it locally on your machine using make targets generated by kubebuilder (`make build`, `make test`, `make run`).
 
 2. Deploy and verify on kubernetes

 - build docker image for the controller and push it to the docker registry


 ```bash
  make docker-build docker-push IMG=<some-registry>/dummy-kyma-module:tag
 ```
 - deploy and verify on kubernetes (i.e locally on k3d)
 
 ```
 make deploy
 ```

 Building docker image and pushing it to the registry should be automated and regularly executed in the development worflow (i.e when mergich changes to main branch (new image tag per commit to main ) or when creating github releases (new image tag per github release))

 3. Generate module manifest

Add the following make target to Makefile:
```
.PHONY: generate-manifest
generate-manifest: manifests kustomize ## Deploy controller to the K8s cluster specified in ~/.kube/config.
	cd config/manager && $(KUSTOMIZE) edit set image controller=${IMG}
	$(KUSTOMIZE) build config/default > manifest.yaml
```

Generate module manifest:
```
make generate-manifest IMG=<some-registry>/dummy-kyma-module:tag
```
This will generate a `manifest.yaml` file referencing the desired IMG as the operator's deployment image.
Now you can deploy your module operator and the sample Dummy CR with the following command


```bash
kubectl create ns kyma-system # <-- only if this namespace doesnt exist yet on the cluster

kubectl apply -f manifest.yaml
kubectl apply -f config/samples/operator_v1alpha1_dummy.yaml
```
These two manifests should be published as release artefacts so that your module users could easily access those related with latest version.

4. Generate module template

In order to allow enabling your module via kyma lifecycle manager you need to generate a module-template

!!! This part will be changed !!! Neighbours will add a pipeline for module contributors that will generate module template ----- 

```bash
kyma alpha create module --channel=fast --name acme.io/module/dummy --version 0.0.1 --path . --registry https://dockerhub.com --output=dummy-fast.yaml
```

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -----

5. Test with local lifecycle manager

You need a kubernetes instance with lifecycle manager installed. The following installs lifecycle manager on the target cluster 
```
kyma alpha deploy
```
Next, you should apply your module template and enable it in Kyma
```
kubeclt apply -f dummy-fast.yaml
kyma alpha enable module dummy -c fast
```

Verify installation. Kyma CR and Dummy CR should eventually resolve statuses to "Ready" 
```
kubectl get kymas -Aw
```
```
kubectl get dummies -Aw
```
6. Test your module on single managed kyma instance on Canary landscape

 - create kyma instance on STAGE landscape
 - connect to the instance via kubectl
 - apply module template locally on the cluster
 ```
 kubeclt apply -f dummy-fast.yaml
 ```
 - enable your module by editing Kyma CR locally on the cluster
 ```
 kubectl edit kymas.operator.kyma-project.io -n kyma-system default-kyma
 ```
to add
```
- channel: fast
  name: dummy
  remoteModuleTemplateRef: dummy
```
in the `spec.module` section.
 - Verify installation
Kyma CR and Dummy CR should eventually resolve statuses to "Ready" 
```
kubectl get kymas -Aw
```
```
kubectl get dummies -Aw
```

7. Enable you module template on control-plane on DEV landscape.

For the following  you need Kyma Developer CAM profile as you need access to the control plane kubernetes.

Connect to the control plane kubernetes on DEV
```
gcloud container clusters get-credentials kyma-mps-dev --region europe-west1 --project sap-ti-dx-kyma-mps-dev
```
Apply module template 
```
kubeclt apply -f dummy-fast.yaml
```

From now on it is possible to enable your module at any kyma instance on DEV

8. Submit Module Template to the fast release channel

Create a pull request to the `https://github.tools.sap/kyma/kyma-modules/tree/main/fast` introducing template of your module. 
Use `"operator.kyma-project.io/beta": "true"` and `"operator.kyma-project.io/internal": "true"` labels to indicate that your module is still in pre-GA phase - only available for intrnal SAP teams as BETA feature ( with "best effort" SLAs)


9. GO GA!

Once you are ready to face all customers of managed Kyma runtimes and fulfill the operation support you would need to remove the `"operator.kyma-project.io/beta": "true"` and `"operator.kyma-project.io/internal": "true"` labels in the module template in `https://github.tools.sap/kyma/kyma-modules`. Congrats, you're live with your module